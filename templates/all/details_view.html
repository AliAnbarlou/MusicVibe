{% extends "base.html" %}
{% load static %}
{% load hitcount_tags %}
{% block title %}{{postsindb.title}} - Music Vibe{% endblock title %}
{% block head %}
    <meta name="description" content="Listen to {{postsindb.title}} by {{postsindb.artist}}- MusicVibe">
    <meta name="keywords" content="{{postsindb.title}} , {{postsindb.artist_name}} , {{postsindb.title}} MusicVibe , {{postsindb.artist_name}} Trend">
    <meta property="og:title" content="{{ postsindb.title }} | MusicVibe"/>
    <meta property="og:image" content="https://music-vibe.com/{{postsindb.image.url}}"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="600"/>
    <meta property="og:type" content="music.song" />
    <meta property="og:url" content="https://music-vibe.com/all/{{postsindb.id}}"/>
    <meta property="og:site_name" content="Listen to {{postsindb.title}} in MusicVibe"/>
    <link rel="stylesheet" href="{% static 'css/indexstyle.css' %}">
    <link rel="stylesheet" href="{% static 'css/det_view.css' %}">
    <script>
        !function(e,t,n){e.yektanetAnalyticsObject=n,e[n]=e[n]||function(){e[n].q.push(arguments)},e[n].q=e[n].q||[];var a=t.getElementsByTagName("head")[0],r=new Date,c="https://cdn.yektanet.com/superscript/WaDFfMQ0/native-music-vibe.com-36997/yn_pub.js?v="+r.getFullYear().toString()+"0"+r.getMonth()+"0"+r.getDate()+"0"+r.getHours(),s=t.createElement("link");s.rel="preload",s.as="script",s.href=c,a.appendChild(s);var l=t.createElement("script");l.async=!0,l.src=c,a.appendChild(l)}(window,document,"yektanet");
    </script>
    <!--
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback" defer>
        window.onloadTurnstileCallback = function () {
            turnstile.render('#example-container', {
                sitekey: '0x4AAAAAAAVgfAfwYymv44Xx',
                callback: function(token) {
                    console.log(`Challenge Success ${token}`);
                },
            });
        };
    </script>-->
{% endblock head %}
{% block content %}
<section class="music-detail col-9 col-md-6 col-lg-4">
    <div class="w-100" style="background-color: #111; border-radius: 8px 8px 0 0;">
        <img src="{{ postsindb.image.url }}" class=" music-detail__banner" alt="Image">
    </div>
        <div class="music-caption w-100">
            <div class="col-12 col-sm-6 mx-auto">
                <marquee behavior="scroll" direction="left" scrollamount="6" class="fs-1" id="charkhande">{{ postsindb.title }} - {{ postsindb.artist }}</marquee>
            </div>
            <h5  class="text-center discription mb-4">{{ postsindb.full_description }}</h5>
            <div class="music-topics justify-content-center mb-2">
                {% for i in tags %}
                    <p class="topic">{{i.name}}</p>
                {% endfor %}
            </div>
        </div>
</section>
        <div class="music">
            <div class="d-flex align-items-center justify-content-center" style="gap: 3.5rem;">
                <div class="d-flex flex-column align-items-center justify-content-center" >
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="3rem" height="3rem" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                        </svg>
                    </span>
                    <p>{% get_hit_count for postsindb %}</p>
                </div>
                <div class="d-flex flex-column align-items-center justify-content-center">
                    <button id="shareButton" class="share-button">
                        <svg class="share-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M20 17.28c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l9.03-5.35c.52.47 1.2.77 1.96.77 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L7.06 9.05C6.54 8.58 5.86 8.28 5.1 8.28c-1.66 0-3 1.34-3 3s1.34 3 3 3c.76 0 1.44-.3 1.96-.77l9.03 5.35c-.05.23-.09.46-.09.7 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/>
                        </svg>
                    </button>
                    <p class="mt-2 mb-0">tap to share</p>
                </div>
            </div>
            <audio controls class="col-11 col-sm-7 col-md-9 col-lg-6 mx-auto d-block mt-5" preload="none">
                <source src="{{ postsindb.audio_file.url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <a href="{{ postsindb.audio_file.url }}" download="{{ postsindb.title }}-music-vibe.com.mp3" class="btn btn-lg col-11 col-sm-7 col-md-9 col-lg-6 d-block" style="background-color: #5BBCFF; color:black;margin: 25px auto 90px auto;">Download</a>
            <script src="{% static 'js/share.js' %}"></script>
            {% if not postsindb.lyrics %}
                
            {% else %}
                <div class="lyric col-11 col-md-9 col-lg-6">
                    <div class="lyrics__content">
                        <p class="lyric__label">Lyrics</p>
                        <p class="lyric__txt" style="margin: 0px;">{{ postsindb.lyrics|linebreaksbr }}</p>
                    </div>
                </div>
            {% endif %}
    
        </div>
        <div class="comment-form col-11 col-sm-7 col-md-9 col-lg-6">
            <h2 class="text-center">Add a Comment</h2>
            <form id="commentForm" method="post">
                {% csrf_token %}
                <div>
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="writer" maxlength="30" minlength="3" required placeholder="your name">
                </div>
                
                <div>
                    <label for="comment">Comment:</label>
                    <textarea required id="Comment" name="comment_text" placeholder="you comment" maxlength="2000" minlength="3"></textarea>
                </div>
                <input type="hidden" name="article" value="{{ postsindb.id }}">
                <!--<div class="cf-turnstile w-50" data-sitekey="0x4AAAAAAAVgfAfwYymv44Xx" data-callback="javascriptCallback"></div>-->
                <button type="submit">Submit</button>
            </form>
        </div>
        <ul class="list-group col-11 col-sm-7 col-lg-6 col-md-9 mx-auto px-4 overflow-auto bg-dark-subtle comments mb-5">
            {% for i in postsindb.comments.all %}
            <li class="d-flex flex-column list-group-item-light mt-3">
                <h4>{{i.writer}} :</h4>
                <div class="d-flex justify-content-between" style="word-wrap: break-word;">
                    <p style="max-width: 60%;" >{{i.comment_text}}</p>
                    <p>{{i.created_at}}</p>
                </div>
            </li>
            <hr class="m-0">
            {% endfor %}
        </ul>
    <div class="d-flex flex-column container">
        <h3>Similar Songs</h3>
        <div class="w-100 d-flex container dash">
            <div class="box">
                <ul class="slider">
                    {% for post in recent_posts %}
                        {% if postsindb.title != post.title %}
                        <li>
                            <div>
                                <a href="{% url 'det' post.id %}" class="text-decoration-none">
                                    <div class="music-list-child">
                                        <div class="music-list-img">
                                            <img src="{{ post.image.url }}" alt="{{ post.title }} music" title="{{ post.title }}">
                                        </div>
                                        <div class="music-list-title">
                                            <h3>{{ post.title }}</h3>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <br>
            </div>
        </div>
        <h3>More Songs From {{postsindb.artist}}</h3>
        <div class="w-100 d-flex container dash">
            <div class="box">
                <ul class="slider">
                    {% for post in recent_posts_artist %}
                    <li>
                        <div>
                            <a href="{% url 'det' post.id%}" class="text-decoration-none">
                                <div class="music-list-child">
                                    <div class="music-list-img">
                                        <img src="{{post.image.url}}" alt="{{post.title}} music" title="{{post.title}}">
                                    </div>
                                    <div class="music-list-title">
                                        <h3>{{post.title}}</h3>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </li>  
                    {% endfor %}
                </ul>
                <br>
            </div>
        </div>
    </div>


{% endblock content %}